{"ast":null,"code":"import { useState, useCallback, useEffect } from 'react';\nimport { useDeepCompareMemo } from 'use-deep-compare';\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\nconst isBrowser = typeof window !== 'undefined' && window.document && window.document.createElement;\n/**\r\n * Necessary to prevent mismatch between the client and server on initial render in ssr mode.\r\n */\n\nconst initImages = isBrowser ? Array.from(document.images) : []; // Live array, need to convert to a regular\n\nlet normInitImages;\nconst getLazyInitImages = () => {\n  if (!normInitImages) {\n    normInitImages = initImages.map(img => img.src).filter(src => !src.startsWith('data:image'));\n  }\n  return normInitImages;\n};\nconst isInitImage = src => getLazyInitImages().some(initImgSrc => src && (initImgSrc == null ? void 0 : initImgSrc.endsWith(src)));\nconst isInitSsr = (isSsrMode = false, src) => {\n  if (isSsrMode && src && isBrowser && document.readyState !== 'complete' && isInitImage(src)) {\n    return true;\n  }\n  return false;\n};\nfunction normArg(obj) {\n  const normObj = _extends({}, obj, {\n    srcset: obj.srcSet\n  });\n  delete normObj.srcSet;\n  Object.keys(normObj).forEach(key => {\n    if (normObj[key] === undefined) {\n      delete normObj[key];\n    }\n  });\n  return normObj;\n}\nconst useProgressiveImage = ({\n  img: imgArg,\n  sources: sourcesArg,\n  ssr: _ssr = false\n}) => {\n  const [, setRerender] = useState(false);\n  const [errorEvent, setErrorEvent] = useState(undefined);\n  const rerender = useCallback(() => {\n    setRerender(prev => !prev);\n  }, []);\n  const handleError = useCallback(event => {\n    setErrorEvent(event);\n  }, []); // eslint-disable-next-line consistent-return\n\n  const image = useDeepCompareMemo(() => {\n    const src = typeof imgArg === 'string' ? imgArg : imgArg == null ? void 0 : imgArg.src;\n    if (src && isBrowser && !isInitSsr(_ssr, src)) {\n      const img = document.createElement('img');\n      if (sourcesArg && sourcesArg.length > 0) {\n        const pic = document.createElement('picture');\n        sourcesArg == null ? void 0 : sourcesArg.forEach(sourceProps => {\n          const source = document.createElement('source');\n          Object.assign(source, normArg(sourceProps));\n          pic.appendChild(source);\n        });\n        pic == null ? void 0 : pic.appendChild(img);\n      }\n      img.onload = rerender;\n      img.onerror = handleError;\n      Object.assign(img, normArg(typeof imgArg === 'string' ? {\n        src: imgArg\n      } : imgArg)); // eslint-disable-line @typescript-eslint/no-non-null-assertion\n\n      return img;\n    }\n  }, [imgArg, sourcesArg, rerender, handleError, _ssr]);\n  useEffect(() => () => {\n    if (image) {\n      image.onload = null;\n      image.onerror = null;\n    }\n  }, [image]);\n  if (image != null && image.complete || !image) {\n    return [false, errorEvent];\n  }\n  return [true, errorEvent];\n};\nexport default useProgressiveImage;","map":{"version":3,"names":["isBrowser","window","document","createElement","initImages","Array","from","images","normInitImages","getLazyInitImages","map","img","src","filter","startsWith","isInitImage","some","initImgSrc","endsWith","isInitSsr","isSsrMode","readyState","normArg","obj","normObj","_extends","srcset","srcSet","Object","keys","forEach","key","undefined","useProgressiveImage","imgArg","sources","sourcesArg","ssr","_ssr","setRerender","useState","errorEvent","setErrorEvent","rerender","useCallback","prev","handleError","event","image","useDeepCompareMemo","length","pic","sourceProps","source","assign","appendChild","onload","onerror","useEffect","complete"],"sources":["/Users/kaylei/work/chester/node_modules/.pnpm/@ohs+use-progressive-image@2.0.1_react@18.3.1/node_modules/@ohs/use-progressive-image/src/index.ts"],"sourcesContent":["import {\n  useEffect, useState, useCallback,\n} from 'react';\nimport { useDeepCompareMemo } from 'use-deep-compare';\n\ntype ImgArg = {\n  sizes?: string;\n  src?: string;\n  srcSet?: string;\n}\ntype SourceArg = {\n  sizes?: string;\n  src?: string;\n  srcSet?: string;\n  type?: string;\n}\ntype SourcesArg = SourceArg[]\nexport type UseProgressiveImageArg = {\n  img?: ImgArg | string;\n  sources?: SourcesArg;\n  ssr?: boolean;\n}\nexport type UseProgressiveImageReturn = [\n  boolean,\n  Event | string | undefined,\n]\n\nconst isBrowser = typeof window !== 'undefined' && window.document && window.document.createElement;\n\n/**\n * Necessary to prevent mismatch between the client and server on initial render in ssr mode.\n */\nconst initImages = isBrowser ? Array.from(document.images) : []; // Live array, need to convert to a regular\nlet normInitImages: string[] | undefined;\nconst getLazyInitImages = (): string[] => {\n  if (!normInitImages) {\n    normInitImages = initImages.map((img) => img.src).filter((src) => !src.startsWith('data:image'));\n  }\n  return normInitImages;\n};\nconst isInitImage = (src: string | undefined): boolean => getLazyInitImages().some(\n  (initImgSrc) => src && initImgSrc?.endsWith(src),\n);\nconst isInitSsr = (isSsrMode = false, src?: string): boolean => {\n  if (isSsrMode && src && isBrowser && document.readyState !== 'complete' && isInitImage(src)) {\n    return true;\n  }\n  return false;\n};\n\nfunction normArg(obj: ImgArg): Omit<ImgArg, 'srcSet'> | { 'srcset': ImgArg['srcSet'] }\nfunction normArg(obj: SourceArg): Omit<SourceArg, 'srcSet'> | { 'srcset': SourceArg['srcSet'] }[]\nfunction normArg(obj: SourceArg): Omit<SourceArg, 'srcSet'> | { 'srcset': SourceArg['srcSet'] }[]\nfunction normArg(obj: any): any {\n  const normObj = { ...obj, srcset: obj.srcSet };\n  delete normObj.srcSet;\n  Object.keys(normObj).forEach((key) => {\n    if (normObj[key] === undefined) {\n      delete normObj[key];\n    }\n  });\n  return normObj;\n}\n\nconst useProgressiveImage = ({\n  img: imgArg,\n  sources: sourcesArg,\n  ssr = false,\n}: UseProgressiveImageArg): UseProgressiveImageReturn => {\n  const [, setRerender] = useState(false);\n  const [errorEvent, setErrorEvent] = useState<Event | string | undefined>(undefined);\n\n  const rerender = useCallback(() => {\n    setRerender((prev) => !prev);\n  }, []);\n\n  const handleError = useCallback((event: Event | string) => {\n    setErrorEvent(event);\n  }, []);\n\n  // eslint-disable-next-line consistent-return\n  const image = useDeepCompareMemo<HTMLImageElement | undefined>(() => {\n    const src = typeof imgArg === 'string' ? imgArg : imgArg?.src;\n    if (src && isBrowser && !isInitSsr(ssr, src)) {\n      const img = document.createElement('img');\n\n      if (sourcesArg && sourcesArg.length > 0) {\n        const pic = document.createElement('picture');\n        sourcesArg?.forEach((sourceProps) => {\n          const source = document.createElement('source');\n          Object.assign(source, normArg(sourceProps));\n          pic.appendChild(source);\n        });\n        pic?.appendChild(img);\n      }\n\n      img.onload = rerender;\n      img.onerror = handleError;\n      Object.assign(img, normArg(typeof imgArg === 'string' ? { src: imgArg } : imgArg!)); // eslint-disable-line @typescript-eslint/no-non-null-assertion\n      return img;\n    }\n  }, [imgArg, sourcesArg, rerender, handleError, ssr]);\n\n  useEffect(() => () => {\n    if (image) {\n      image.onload = null;\n      image.onerror = null;\n    }\n  }, [image]);\n\n  if (image?.complete || !image) {\n    return [false, errorEvent];\n  }\n  return [true, errorEvent];\n};\n\nexport default useProgressiveImage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}